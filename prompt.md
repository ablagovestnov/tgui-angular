# Перенос UI компонентов из React в Angular для Telegram Web Apps

## Контекст проекта

Мы работаем над созданием библиотеки Angular UI компонентов для Telegram Web Apps (TWA). Проект представляет собой порт существующей React библиотеки компонентов в экосистему Angular 19+. Библиотека предоставляет набор готовых компонентов, стилизованных в соответствии с дизайн-системой Telegram и адаптированных для использования в мини-приложениях Telegram. Ты отвечаешь на русском языке.

## Цели проекта

1. Реализовать полный набор компонентов, соответствующих React-версии библиотеки
2. Сохранить визуальную и функциональную идентичность компонентов
3. Адаптировать компоненты под архитектуру и паттерны Angular
4. Обеспечить поддержку автоматического определения и переключения тем (светлая/темная)
5. Реализовать адаптацию под различные платформы (iOS/базовая)
6. Создать понятную документацию и демонстрационные примеры
7. Обеспечить полную поддержку функциональности Telegram WebApp API
8. Создать адаптивные компоненты, работающие на всех платформах Telegram (мобильная, десктоп, веб)
9. Реализовать поддержку как полноэкранного, так и компактного режимов отображения
10. Обеспечить соответствие дизайн-системе из Figma Telegram UI Kit
11. Подготовить библиотеку к публикации в NPM для удобного использования разработчиками

## Текущая структура проекта

Корневая папка содержит директории с React библиотекой (TelegramUI-react-library-to-translate) и Angular библиотекой (TGUIAngular)

Проект Angular библиотеки организован как монорепозиторий с двумя основными подпроектами:
- `projects/tgui` - основная библиотека компонентов
- `projects/demo` - демонстрационное приложение для тестирования и документации

Библиотека компонентов включает:
- Корневой компонент (`tgui-root`) для настройки темы и платформы
- Сервисы для работы с темой, платформой и Telegram WebApp API
- Базовые компоненты (кнопки, типографика, аватары, спиннеры и др.)
- Вспомогательные утилиты и директивы

## Реализованные компоненты и сервисы

На текущий момент реализованы следующие компоненты:

### Основные компоненты:
1. **Button** (`tgui-button`) - многофункциональная кнопка с поддержкой различных режимов отображения (filled, bezeled, plain, gray, outline, white), размеров, состояний загрузки и анимацией ripple-эффекта
2. **Typography** - набор типографских компонентов, соответствующих дизайн-системе Telegram:
   - `tgui-text` - базовый текстовый компонент
   - `tgui-caption` - мелкий текст
   - `tgui-headline` - заголовок
   - `tgui-large-title` - крупный заголовок
   - `tgui-subheadline` - подзаголовок
   - `tgui-title` - стандартный заголовок
3. **Avatar** (`tgui-avatar`) - компонент для отображения аватаров с поддержкой изображений, инициалов и заполнителей
4. **Avatar Stack** (`tgui-avatar-stack`) - группировка нескольких аватаров с перекрытием
5. **Spinner** (`tgui-spinner`) - индикатор загрузки, соответствующий стилю Telegram
6. **Badge** (`tgui-badge`) - компонент для отображения числовых и текстовых индикаторов
7. **Section** (`tgui-section`) - компонент для группировки элементов интерфейса
8. **Card** (`tgui-card`) - карточка для отображения содержимого
9. **Divider** (`tgui-divider`) - разделительная линия
10. **Chip** (`tgui-chip`) - компонент для отображения выбираемых элементов

### Служебные компоненты:
1. **TGUIRoot** (`tgui-root`) - корневой компонент для настройки темы и платформы
2. **RootPortal** (`tgui-root-portal`) - компонент для рендеринга контента в корневой DOM-узел
3. **Tappable** (`tgui-tappable`) - компонент для обработки тапов/кликов с поддержкой анимации
4. **Ripple** (`tgui-ripple`) - компонент для создания ripple-эффекта на элементах

### Сервисы:
1. **ThemeService** - сервис для управления темой приложения (светлая/темная)
2. **PlatformService** - сервис для определения и установки целевой платформы (iOS/базовая)
3. **PortalService** - сервис для управления порталами и модальными окнами
4. **TelegramService** - сервис для взаимодействия с Telegram WebApp API
5. **RippleService** - сервис для создания ripple-эффекта на элементах

### Директивы:
1. **TGUIThemeDirective** - директива для локального управления темой
2. **PortalOutletDirective** - директива для определения места вывода контента портала

## Технические требования

1. Компоненты должны быть реализованы как standalone-компоненты Angular 19+ c signal api
2. Компоненты должны поддерживать адаптивную смену темы через CSS-переменные
3. Стилизация должна учитывать особенности разных платформ (iOS/базовая)
4. Библиотека должна предоставлять удобный API для интеграции с TWA
5. Компоненты должны быть протестированы и документированы
6. Должна быть обеспечена поддержка следующих функций Telegram WebApp API:
   - Автоматическое переключение темы при событии themeChanged
   - Адаптация при переходе в полноэкранный режим
   - Реакция на изменение viewport (viewportChanged)
   - Адаптация при появлении/скрытии MainButton
   - Корректные отступы (insets и safe areas) для iOS и Android
   - Поддержка tabbar и навигации в футере
7. Компоненты должны быть адаптивными и корректно отображаться на различных устройствах
8. Библиотека должна иметь модульную структуру для возможности импорта только необходимых компонентов
9. Должна быть обеспечена полная совместимость с дизайн-системой Telegram, изложенной в [Figma Telegram UI Kit](https://www.figma.com/community/file/1348989725141777736)

## Принципы миграции

При переносе компонентов из React в Angular следует придерживаться следующих принципов:

1. **Сохранение внешнего вида**: Все визуальные аспекты компонентов должны соответствовать оригинальной React-версии
2. **Адаптация паттернов**: React-паттерны (например, компоненты высшего порядка) должны быть адаптированы под Angular-паттерны (директивы, сервисы, декораторы)
3. **Интеграция с Angular**: Компоненты должны использовать возможности Angular (инъекция зависимостей, декораторы, сигналы)
4. **Модульность**: Каждый компонент должен быть самодостаточным и минимально зависеть от других компонентов

## План работы

1. Анализ существующих React-компонентов и их группировка по сложности и зависимостям
2. Настройка базовой структуры проекта, системы тем и платформ
3. Реализация базовых компонентов (кнопки, типографика, спиннеры)
4. Реализация сложных компонентов (модальные окна, формы, списки)
5. Создание тестов и документации
6. Разработка демонстрационного приложения

## Компоненты для миграции (в порядке приоритета)

1. **Toast** - всплывающие уведомления
2. **Checkbox** и **Radio** - компоненты для элементов выбора
3. **Switch** - переключатель
4. **Input** и **TextArea** - поля ввода
5. **Modal** и **Dialog** - модальные окна и диалоги
6. **Menu** - выпадающее меню
7. **Tabs** - компонент для вкладок
8. **Pagination** - компонент для пагинации
9. **List** и **ListItem** - списки

## Задачи на текущем этапе

1. Портировать оставшиеся базовые компоненты
2. Улучшить систему тем для более точного соответствия дизайн-системе Telegram
3. Расширить поддержку API Telegram WebApp
4. Создать storybook-документацию для реализованных компонентов
5. Разработать тесты для проверки совместимости с различными версиями Angular

## Приоритетные направления улучшений

На основе требований [GitHub issue](https://github.com/ton-society/grants-and-bounties/issues/606) необходимо сфокусироваться на следующих направлениях улучшений:

### 1. Расширенная поддержка Telegram WebApp API

- **Обработка событий для адаптивности**:
  - Реакция на `themeChanged` для мгновенного переключения тем
  - Обработка `viewportChanged` для адаптации интерфейса при изменении размера окна
  - Переход в полноэкранный режим при запуске приложения
  - Корректная адаптация UI при появлении/скрытии Main Button через `setParams`

- **Режимы отображения**:
  - Учет особенностей как полноэкранного, так и компактного (embedded) режимов
  - Специальная адаптация компонентов для каждого режима отображения

### 2. Безопасные зоны и отступы

- **Поддержка insets и safe areas**:
  - Корректные отступы для iOS и Android
  - Учет системных областей (вырезы, закругленные углы экрана)
  - Адаптивное позиционирование элементов с учетом безопасных зон

### 3. Навигационные компоненты

- **Реализация табов и навигации**:
  - Tabbar для нижней навигации
  - Поддержка навигационных элементов в футере
  - Адаптация под оба режима отображения (полноэкранный и компактный)

### 4. Улучшенная адаптивность 

- **Отзывчивый дизайн**:
  - Тестирование компонентов на различных размерах экрана
  - Поддержка разных ориентаций устройства (портретная/ландшафтная)
  - Обеспечение сохранения функциональности при любых размерах экрана

### 5. Интеграция с дизайн-системой

- **Точное соответствие Figma Telegram UI Kit**:
  - Реализация всех интерактивных состояний (hover, active, disabled)
  - Поддержка всех цветовых токенов Telegram
  - Корректное отображение шрифтов и типографики

### 6. Производительность

- **Оптимизация компонентов**:
  - Минимизация времени рендеринга
  - Эффективный пайплайн для CSS-переменных
  - Оптимизация бандла для минимального размера

## Ожидаемые результаты

По завершению проекта должны быть предоставлены следующие результаты:

1. **Исходный код библиотеки**:
   - Полный набор компонентов в соответствии с дизайн-системой Telegram
   - Реализация всех необходимых сервисов для интеграции с Telegram WebApp API
   - Высокое качество кода и покрытие тестами

2. **Демонстрационная страница**:
   - Интерактивный каталог всех компонентов
   - Примеры использования компонентов в различных сценариях
   - Мобильно-адаптивная версия для тестирования на разных устройствах

3. **Документация**:
   - Полное описание API каждого компонента
   - Руководство по использованию библиотеки
   - Примеры интеграции с Telegram WebApp API
   - Рекомендации по лучшим практикам

4. **NPM-пакет**:
   - Готовый к публикации пакет
   - Оптимизированная структура для tree-shaking
   - Совместимость с Angular 19+ и TypeScript

Эти результаты должны соответствовать требованиям, указанным в [GitHub issue](https://github.com/ton-society/grants-and-bounties/issues/606), и обеспечивать разработчикам удобный инструмент для создания мини-приложений Telegram на базе Angular.

## Технические заметки

- Для стилизации компонентов используются CSS-переменные, определенные в корневом компоненте
- Для определения платформы и темы используются специальные сервисы с реактивным API
- Компоненты поддерживают как прямое указание темы/платформы, так и автоматическое определение
- Директива `TGUIThemeDirective` позволяет локально переопределять тему для части приложения

## Полезные ссылки

- [Telegram WebApp API](https://core.telegram.org/bots/webapps)
- [Angular документация](https://angular.dev/)
- [Дизайн-система Telegram](https://telegram.org/blog/drawdown-sharing#new-interface)
- [GitHub issue с требованиями к библиотеке](https://github.com/ton-society/grants-and-bounties/issues/606)
- [React UI Components Library для Telegram Mini Apps](https://github.com/Telegram-Mini-Apps/TelegramUI)
- [Figma Telegram UI Kit](https://www.figma.com/community/file/1348989725141777736) 